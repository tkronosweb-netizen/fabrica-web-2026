<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Builder Pro - <%= id %></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root { --primary: #6366f1; --bg: #f8fafc; }
        body { background: var(--bg); font-family: 'Inter', sans-serif; color: #1e293b; }
        .sidebar-nav { background: white; border-radius: 20px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.03); position: sticky; top: 20px; }
        .nav-pills .nav-link { color: #64748b; font-weight: 500; border-radius: 12px; margin-bottom: 5px; border: 1px solid transparent; }
        .nav-pills .nav-link.active { background: #eef2ff; color: var(--primary); border: 1px solid #e0e7ff; }
        .builder-card { background: white; border-radius: 24px; border: none; box-shadow: 0 10px 30px rgba(0,0,0,0.04); padding: 40px; }
        .img-preview-box { border: 2px dashed #e2e8f0; border-radius: 16px; padding: 20px; text-align: center; background: #fcfdfe; transition: 0.3s; }
        .img-preview-box:hover { border-color: var(--primary); }
        .service-item { border: 1px solid #e2e8f0; border-radius: 16px; padding: 20px; margin-bottom: 15px; position: relative; background: #fff; }
    </style>
</head>
<body class="py-5">
    <div class="container">
        <div class="row g-4">
            <div class="col-lg-3">
                <div class="sidebar-nav">
                    <h5 class="fw-bold mb-4 px-3">Constructor Elite</h5>
                    <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist">
                        <button class="nav-link active d-flex align-items-center" data-bs-toggle="pill" data-bs-target="#tab-brand"><i data-lucide="layout" class="me-2 size-5"></i> Identidad</button>
                        <button class="nav-link d-flex align-items-center" data-bs-toggle="pill" data-bs-target="#tab-content"><i data-lucide="box" class="me-2"></i> Servicios</button>
                        <button class="nav-link d-flex align-items-center" data-bs-toggle="pill" data-bs-target="#tab-style"><i data-lucide="palette" class="me-2"></i> Estilo & Social</button>
                    </div>
                    <hr>
                    <div class="px-3 small text-muted">ID Proyecto: <span class="text-dark fw-bold"><%= id %></span></div>
                </div>
            </div>

            <div class="col-lg-9">
                <form action="/guardar/<%= id %>" method="POST" id="mainForm" class="builder-card">
                    <div class="tab-content" id="v-pills-tabContent">
                        
                        <div class="tab-pane fade show active" id="tab-brand">
                            <h4 class="fw-bold mb-4">Identidad Visual</h4>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label fw-semibold">Nombre de la Marca</label>
                                    <input type="text" name="brandName" class="form-control form-control-lg rounded-3" value="<%= data.brandName || '' %>" required>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-semibold">Eslogan de Impacto</label>
                                    <input type="text" name="slogan" class="form-control form-control-lg rounded-3" value="<%= data.slogan || '' %>">
                                </div>
                                <div class="col-12 mt-4">
                                    <label class="form-label fw-semibold">Imagen Principal (Hero URL)</label>
                                    <div class="img-preview-box">
                                        <input type="text" name="heroImg" class="form-control mb-2" value="<%= data.heroImg || '' %>" placeholder="https://ejemplo.com/fondo.jpg">
                                        <p class="small text-muted mb-0">Esta imagen será el primer impacto visual de tu web.</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="tab-pane fade" id="tab-content">
                            <h4 class="fw-bold mb-4">Catálogo de Servicios</h4>
                            <div id="services-container"></div>
                            <button type="button" class="btn btn-outline-primary rounded-pill mt-3" onclick="addService()">+ Añadir nuevo servicio</button>
                        </div>

                        <div class="tab-pane fade" id="tab-style">
                            <h4 class="fw-bold mb-4">Personalización Final</h4>
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <label class="form-label fw-semibold">Color de Acento</label>
                                    <input type="color" name="colorBtn" class="form-control form-control-color w-100 rounded-3" value="<%= data.colorBtn || '#6366f1' %>">
                                </div>
                                <div class="col-md-8">
                                    <label class="form-label fw-semibold">Número de WhatsApp (Sin +)</label>
                                    <input type="text" name="whatsapp" class="form-control rounded-3" value="<%= data.whatsapp || '' %>" placeholder="54911...">
                                </div>
                            </div>
                        </div>

                    </div>

                    <input type="hidden" name="services_json" id="services_json">
                    <div class="mt-5 border-top pt-4 text-end">
                        <button type="submit" class="btn btn-dark btn-lg px-5 rounded-pill shadow-lg">Publicar Cambios</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();
        let services = <%- JSON.stringify(data.services || []) %>;
        function addService() { services.push({ title: '', desc: '', price: '' }); renderServices(); }
        function renderServices() {
            document.getElementById('services-container').innerHTML = services.map((s, i) => `
                <div class="service-item">
                    <input type="text" placeholder="Título del servicio" class="form-control mb-2 fw-bold border-0 bg-light" value="${s.title}" onchange="services[${i}].title=this.value">
                    <textarea class="form-control mb-2 border-0 bg-light" placeholder="Descripción breve..." onchange="services[${i}].desc=this.value">${s.desc}</textarea>
                    <input type="text" placeholder="Precio (ej: $500)" class="form-control border-0 bg-light text-primary fw-bold" value="${s.price}" onchange="services[${i}].price=this.value">
                    <button type="button" class="btn btn-sm text-danger mt-2" onclick="services.splice(${i},1); renderServices()">Eliminar</button>
                </div>
            `).join('');
        }
        document.getElementById('mainForm').onsubmit = () => { document.getElementById('services_json').value = JSON.stringify(services); };
        renderServices();
    </script>
    <script src="
